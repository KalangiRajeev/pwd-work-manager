<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button *ngIf="title; else menuButton" icon="chevron-back" defaultHref="/main/agreement-register"></ion-back-button>
      <ng-template #menuButton>
        <ion-menu-button></ion-menu-button>
      </ng-template>
    </ion-buttons>
    
    <ion-title>{{title ? title : 'Works Register'}}</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <div [formGroup]="searchFormGroup">
      <ion-searchbar [debounce]="1000" formControlName="searchFormControl"></ion-searchbar>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{title ? title : 'Works Register'}}</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-fab class="ion-fab" slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button routerLink="/main/agreement-register/create">
      <ion-icon name="create-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <mat-progress-bar mode="indeterminate" color="accent" *ngIf="isLoading"></mat-progress-bar>

  <mat-tab-group backgroundColor="primary" (selectedTabChange)="matTabSelectedChange($event)" animationDuration="150ms">
    <mat-tab *ngFor="let tabtitle of workStatuses" class="tab-title" [label]="tabtitle">
      <ion-list *ngIf = "isRenderedInMobile; else renderInLargeScreen">
        <ion-item-sliding *ngFor="let agtReg of agreementRegister$ | async; let i = index">
          <ion-item-options side="end">
            <ion-item-option color="danger">
              <ion-icon slot="icon-only" name="trash" button (click)="deleteRecord(agtReg)"></ion-icon>
            </ion-item-option>
          </ion-item-options>

          <ion-item button detail="true" detail-icon="caret-forward"
            [routerLink]="['/main/agreement-register/details/', agtReg.id]" 
            (click)="selectedAgtRegRecord(agtReg)">
            <ion-label class="ion-text-wrap">
              <div class="flex-inline">
                <div>
                  <b>({{(pageIndex*pageSize)+(i+1)}}) Agt No.{{agtReg.agreementNumber}}</b>
                  <p>Agency: {{agtReg.agency.name}}</p>
                </div>
                <mat-chip highlighted [color]="getKeyByValue(agtReg.workStatus)">{{agtReg.workStatus}}</mat-chip>
              </div>
              <p ngClass="text">{{agtReg.nameOfWork}}</p>
            </ion-label>
          </ion-item>
        </ion-item-sliding>
      </ion-list>

      <ng-template #renderInLargeScreen>
        <table class="table table-hover" [ngClass]="isDarkThemeEnabled ? 'table-dark': 'table-light'">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Name of Work</th>
              <!-- <th scope="col">Admin Sanction Ref</th> -->
              <th scope="col">Agreement Ref</th>
              <th scope="col">Amount</th>
              <th scope="col">Agency</th>
              <th scope="col">Date of Completion</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let agtReg of agreementRegister$ | async; let i = index" [routerLink]="['/main/agreement-register/details/', agtReg.id]">
              <td>{{(pageIndex*pageSize)+(i+1)}}</td>
              <td>{{agtReg.nameOfWork}}</td>
              <!-- <th scope="col">{{agtReg.administrativeSanctionReference}}</th> -->
              <td>{{agtReg.agreementNumber}} Dt: {{agtReg.dateOfAgreement | date}}, conluded @ {{agtReg.office.name}}</td>
              <td>{{agtReg.estimateContractValue | currency:'INR':true}}</td>
              <td>{{agtReg.agency.name}}, {{agtReg.agency.address}}</td>
              <td>{{agtReg.dueDateOfCompletion | date}}</td>
              <td><mat-chip highlighted [color]="getKeyByValue(agtReg.workStatus)">{{agtReg.workStatus}}</mat-chip></td>
            </tr>
          </tbody>
        </table>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</ion-content>

<ion-footer>
  <mat-paginator 
  [length]="recordsCount$ | async" 
  [pageSize]="pageSize" 
  [pageSizeOptions]="pageSizeOptions" 
  [pageIndex]="pageIndex"
  [disabled]="isDisabled"
  (page)="handlePageEvent($event)" aria-label="Select page">
  </mat-paginator>
</ion-footer>